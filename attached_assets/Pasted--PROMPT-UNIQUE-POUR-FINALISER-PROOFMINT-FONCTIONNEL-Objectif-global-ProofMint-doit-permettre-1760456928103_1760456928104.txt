ğŸ§© PROMPT UNIQUE POUR FINALISER PROOFMINT (FONCTIONNEL)
ğŸ¯ Objectif global

ProofMint doit permettre Ã  lâ€™utilisateur :
1ï¸âƒ£ de se connecter via la redirection wallet (solution webhook MultiversX actuelle),
2ï¸âƒ£ dâ€™uploader un fichier,
3ï¸âƒ£ de gÃ©nÃ©rer son empreinte SHA-256 localement,
4ï¸âƒ£ dâ€™envoyer une transaction certify:<hash> sur MultiversX Devnet,
5ï¸âƒ£ dâ€™afficher un lien vers lâ€™explorer,
6ï¸âƒ£ et de gÃ©nÃ©rer un certificat PDF contenant le hash, le TX et un QR code.

âš™ï¸ Ã‰tape 1 â€” Hash du fichier localement

CrÃ©e un fichier /src/utils/hashFile.js avec ce contenu :

export async function hashFile(file) {
  const arrayBuffer = await file.arrayBuffer();
  const hashBuffer = await crypto.subtle.digest("SHA-256", arrayBuffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
}

âš™ï¸ Ã‰tape 2 â€” Envoi de la transaction sur la blockchain

CrÃ©e /src/utils/sendTransaction.js :

import { Transaction, TransactionPayload, Address, GasLimit } from "@multiversx/sdk-core";

export async function sendProofTransaction(userAddress, fileHash) {
  const tx = new Transaction({
    data: new TransactionPayload(`certify:${fileHash}`),
    gasLimit: new GasLimit(6000000),
    receiver: new Address(userAddress),
    value: "0",
  });

  const response = await fetch("https://devnet-gateway.multiversx.com/transactions", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(tx.toPlainObject()),
  });

  const result = await response.json();
  console.log("âœ… Transaction envoyÃ©e :", result);
  return result.txHash;
}

âš™ï¸ Ã‰tape 3 â€” Affichage du rÃ©sultat

CrÃ©e /src/components/ProofResult.jsx :

export function ProofResult({ txHash }) {
  return (
    <div className="text-center mt-6">
      <h2 className="text-xl font-bold text-white">âœ… Certification rÃ©ussie</h2>
      <p className="text-gray-400 mt-2">
        Transaction visible sur MultiversX Explorer :
      </p>
      <a
        href={`https://devnet-explorer.multiversx.com/transactions/${txHash}`}
        target="_blank"
        rel="noreferrer"
        className="text-primary underline"
      >
        {txHash}
      </a>
    </div>
  );
}

âš™ï¸ Ã‰tape 4 â€” GÃ©nÃ©ration du certificat PDF

CrÃ©e /src/utils/generateProofPDF.js :

import jsPDF from "jspdf";
import QRCode from "qrcode";

export async function generateProofPDF(fileName, hash, txHash) {
  const doc = new jsPDF();
  const qr = await QRCode.toDataURL(`https://devnet-explorer.multiversx.com/transactions/${txHash}`);

  doc.setFontSize(20);
  doc.text("ProofMint Certificate", 20, 20);
  doc.setFontSize(12);
  doc.text(`File: ${fileName}`, 20, 40);
  doc.text(`Hash: ${hash}`, 20, 50);
  doc.text(`Transaction: ${txHash}`, 20, 60);
  doc.addImage(qr, "PNG", 20, 70, 40, 40);
  doc.text("Certified on MultiversX (Devnet)", 20, 130);

  doc.save(`${fileName}_proofmint.pdf`);
}

âš™ï¸ Ã‰tape 5 â€” IntÃ©gration du flux complet dans la page principale

Modifie /src/pages/UploadCertify.jsx :

import React, { useState } from "react";
import { hashFile } from "../utils/hashFile";
import { sendProofTransaction } from "../utils/sendTransaction";
import { generateProofPDF } from "../utils/generateProofPDF";
import { ProofResult } from "../components/ProofResult";

export default function UploadCertify() {
  const [file, setFile] = useState(null);
  const [txHash, setTxHash] = useState("");
  const [hash, setHash] = useState("");
  const [walletAddress, setWalletAddress] = useState("");

  // RÃ©cupÃ©ration de lâ€™adresse depuis lâ€™URL ?address=...
  React.useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const addr = params.get("address");
    if (addr) setWalletAddress(addr);
  }, []);

  const handleCertify = async () => {
    if (!file || !walletAddress) {
      alert("Connecte ton wallet et choisis un fichier dâ€™abord.");
      return;
    }
    const fileHash = await hashFile(file);
    setHash(fileHash);
    const tx = await sendProofTransaction(walletAddress, fileHash);
    setTxHash(tx);
  };

  const handleDownloadPDF = async () => {
    await generateProofPDF(file.name, hash, txHash);
  };

  return (
    <div className="text-center text-white mt-10">
      <h1 className="text-3xl font-bold mb-4">ProofMint</h1>

      {!walletAddress ? (
        <a
          href="https://devnet-wallet.multiversx.com/dapp/init?callbackUrl=https://YOUR-APP-URL.repl.co"
          className="bg-blue-600 px-5 py-2 rounded-xl text-white"
        >
          Connect Wallet
        </a>
      ) : (
        <p className="text-green-400 mb-4">âœ… Wallet connectÃ© : {walletAddress.slice(0, 6)}...{walletAddress.slice(-4)}</p>
      )}

      <input type="file" onChange={(e) => setFile(e.target.files[0])} className="my-4" />
      <button onClick={handleCertify} className="bg-primary text-white px-6 py-2 rounded-xl">
        Certifier sur blockchain
      </button>

      {txHash && (
        <>
          <ProofResult txHash={txHash} />
          <button onClick={handleDownloadPDF} className="mt-4 bg-green-600 px-4 py-2 rounded-xl">
            TÃ©lÃ©charger le certificat PDF
          </button>
        </>
      )}
    </div>
  );
}


ğŸ” Remplace https://YOUR-APP-URL.repl.co par lâ€™URL exacte de ton projet Replit
(celle qui sâ€™ouvre quand tu cliques sur â€œRunâ€).

âš™ï¸ Ã‰tape 6 â€” Test complet

1ï¸âƒ£ Clique sur Connect Wallet â†’ ton wallet devnet sâ€™ouvre
2ï¸âƒ£ Connecte-toi â†’ redirection avec ?address=erd1...
3ï¸âƒ£ Uploade un fichier â†’ clique sur Certifier sur blockchain
4ï¸âƒ£ Attends quelques secondes â†’ un lien apparaÃ®t vers Explorer Devnet
5ï¸âƒ£ Clique sur TÃ©lÃ©charger le certificat PDF

Le PDF doit contenir ton hash, ton TX et un QR code valide.

âœ… Si ces Ã©tapes fonctionnent â†’
ProofMint est opÃ©rationnel sur MultiversX Devnet.
Tu pourras ensuite :

migrer vers mainnet,

ajouter WalletConnect v2,

et amÃ©liorer le style MultiversX/xPortal.